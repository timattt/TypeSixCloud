# Облако для type-6

Тут лежат конфиги для поднятия облака в яндексе.

## Сервисы

* K8S кластер с 1 узлом
* Postgres

## Инструкция по выкатыванию в облако

* Подключаемся к облаку с помощью команды:

```
yc init
```

* Получаем токен для авторизации в terraform

```
yc iam create token
```

### Через докер

* Собираем и запускаем докер образ.

```
docker build -t type-6-ter .
```

```
docker run --env "TYPE6_DB_USERNAME=?" --env "TYPE6_DB_PASSWORD=?" --env "TYPE6_FOLDER_ID=?" --env "TYPE6_CLOUD_ID=?" --env "TYPE6_TOKEN=?" -v "./state:/state" type-6-ter
```

Здесь необходимо указать имя и пароль для пользователя из БД, идентификатор облака и папки - это все можно посмотреть на сайте облака. И токен, 
который сгенерировали до этого.

### Без докера

* Устанавливаем terraform
* Подкладываем файл .terraformmrc в ~/.terraformrc
* Инициализируемся 

```
terraform init
```

* Запускаем конфигурацию

```
terraform apply -state="../state/state.json"
```

Там нас попросят ввести параметры, как и в докере.

## Альтернативный вариант авторизации вместо токена

Можно на сайте облака в панели сервисного акаунта сгенерировать **авторизированный** ключ и потом подложить его в папку скриптов.